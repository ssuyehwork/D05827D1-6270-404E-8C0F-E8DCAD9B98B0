# -*- coding: utf-8 -*-
# services/backup_service.pyimport osimport shutilfrom datetime import datetimefrom core.config import DB_NAME, BACKUP_DIRclass BackupService:    @staticmethod    def run_backup():        """执行数据库备份并清理旧文件"""        if not os.path.exists(BACKUP_DIR):            os.makedirs(BACKUP_DIR)                if os.path.exists(DB_NAME):            timestamp = datetime.now().strftime('%Y%m%d_%H%M%S')            target = os.path.join(BACKUP_DIR, f'ideas_{timestamp}.db')            try:                shutil.copy2(DB_NAME, target)                BackupService._clean_old_backups()                print(f"[System] Backup created: {target}")            except Exception as e:                print(f"[System] Backup failed: {e}")    @staticmethod    def _clean_old_backups(keep=20):        try:            files = sorted(                [os.path.join(BACKUP_DIR, f) for f in os.listdir(BACKUP_DIR)],                key=os.path.getmtime            )            while len(files) > keep:                os.remove(files.pop(0))        except Exception:            pass